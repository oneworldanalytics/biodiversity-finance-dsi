<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.52">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Presentations from Day Two – The LSE Roundtable on DSI</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
<meta name="twitter:title" content="Presentations from Day Two – The LSE Roundtable on DSI">
<meta name="twitter:image" content="pointing_to_cali.jpeg">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">The LSE Roundtable on DSI</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Background</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./presentations.html"> 
<span class="menu-text">Presentations</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./interim_ways_forward.html"> 
<span class="menu-text">Ways Forward</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#block-one---recording" id="toc-block-one---recording" class="nav-link active" data-scroll-target="#block-one---recording">Block One - Recording</a>
  <ul class="collapse">
  <li><a href="#data-valuation-trust-and-the-sovereign-commons-license" id="toc-data-valuation-trust-and-the-sovereign-commons-license" class="nav-link" data-scroll-target="#data-valuation-trust-and-the-sovereign-commons-license">Data Valuation, Trust and the Sovereign Commons License</a></li>
  <li><a href="#patent-data-and-dsi-users" id="toc-patent-data-and-dsi-users" class="nav-link" data-scroll-target="#patent-data-and-dsi-users">Patent Data and DSI Users</a></li>
  <li><a href="#mgr-and-dsi-on-mgr-in-the-bbnj-treaty" id="toc-mgr-and-dsi-on-mgr-in-the-bbnj-treaty" class="nav-link" data-scroll-target="#mgr-and-dsi-on-mgr-in-the-bbnj-treaty">MGR and DSI on MGR in the BBNJ Treaty</a></li>
  <li><a href="#the-perspective-from-the-plant-treaty" id="toc-the-perspective-from-the-plant-treaty" class="nav-link" data-scroll-target="#the-perspective-from-the-plant-treaty">The Perspective from the Plant Treaty</a></li>
  </ul></li>
  <li><a href="#block-two---recording" id="toc-block-two---recording" class="nav-link" data-scroll-target="#block-two---recording">Block Two - Recording</a>
  <ul class="collapse">
  <li><a href="#gbifs-approach-to-open-access-to-data-within-a-framework-of-trust-and-transparency" id="toc-gbifs-approach-to-open-access-to-data-within-a-framework-of-trust-and-transparency" class="nav-link" data-scroll-target="#gbifs-approach-to-open-access-to-data-within-a-framework-of-trust-and-transparency">GBIF’s Approach to Open Access to Data within a Framework of Trust and Transparency</a></li>
  <li><a href="#the-insdc-40-years-of-trust" id="toc-the-insdc-40-years-of-trust" class="nav-link" data-scroll-target="#the-insdc-40-years-of-trust">The INSDC: 40 Years of Trust</a></li>
  <li><a href="#the-global-biodata-infrastructure" id="toc-the-global-biodata-infrastructure" class="nav-link" data-scroll-target="#the-global-biodata-infrastructure">The Global Biodata Infrastructure</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Presentations from Day Two</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="block-one---recording" class="level2">
<h2 class="anchored" data-anchor-id="block-one---recording">Block One - <a href="https://echo360.org.uk/media/cdd5970c-c531-4e37-ac10-b426b42171b5/public" target="_blank">Recording</a></h2>
<section id="data-valuation-trust-and-the-sovereign-commons-license" class="level3">
<h3 class="anchored" data-anchor-id="data-valuation-trust-and-the-sovereign-commons-license">Data Valuation, Trust and the Sovereign Commons License</h3>
<section id="paul-oldham-begins-0020" class="level5">
<h5 class="anchored" data-anchor-id="paul-oldham-begins-0020">Paul Oldham (begins: 00:20)</h5>
<p>Paul Oldham from One World Analytics pointed to the inclusion of the OECD Recommendation on Enhancing Access to and Sharing of Data and the UNESCO Recommendation on Open Science in Decision 15/9 and argued that the nature of these documents is sometimes misunderstood. He used the example of the privatisation of Alphafold 3, originally based on openly available data from EMBL-EBI, to raise questions on ensuring fair returns for biodiversity. He pointed to the importance of maintaining relationships between different kinds of data to maintain transparency in how it is being used and put forward the suggestion of a Sovereign Commons Licence, whereby Parties, in the collective exercise of their sovereign rights could decide to establish a common licence for the sharing of digital sequence information.</p>
<p>A further elaboration on the concept of the Sovereign Commons License from Paul Oldham and Siva Thambisetty is available <a href="https://www.dropbox.com/scl/fi/bv46r6269o59lvj9nx2el/The-Sovereign-Commons-Licence.pdf?rlkey=rvmhwslxxn39iwwm8ijvzhu3l&amp;st=2m7fwh4i&amp;dl=0" target="_blank">here</a>.</p>
<section id="slides" class="level6">
<h6 class="anchored" data-anchor-id="slides"><a href="https://www.dropbox.com/scl/fi/779sga69h9k8oo5fao892/oldham_data_trust_alphafold.pptx?rlkey=6eb8rfajg2hxvr3c58xeh4ejm&amp;st=053tmw19&amp;dl=0" target="_blank">Slides</a></h6>
</section>
</section>
</section>
<section id="patent-data-and-dsi-users" class="level3">
<h3 class="anchored" data-anchor-id="patent-data-and-dsi-users">Patent Data and DSI Users</h3>
<section id="paul-oldham-begins-1857" class="level5">
<h5 class="anchored" data-anchor-id="paul-oldham-begins-1857">Paul Oldham (begins: 18:57)</h5>
<p>Paul Oldham demonstrated the importance of patent analytics for understanding trends in science and technology, identifying users of DSI and linking these users to sector classification codes like ISIC codes. He made the point that universities are frequent patent applicants.</p>
<section id="slides-1" class="level6">
<h6 class="anchored" data-anchor-id="slides-1"><a href="https://www.dropbox.com/scl/fi/lfhc3xcqfdsjwkchst2mb/oldham_patent_data_dsi.pptx?rlkey=8doya9np6eledpi8dnmeg6suy&amp;st=0ylfh91d&amp;dl=0" target="_blank">Slides</a></h6>
</section>
</section>
</section>
<section id="mgr-and-dsi-on-mgr-in-the-bbnj-treaty" class="level3">
<h3 class="anchored" data-anchor-id="mgr-and-dsi-on-mgr-in-the-bbnj-treaty">MGR and DSI on MGR in the BBNJ Treaty</h3>
<section id="siva-thambisetty-begins-2736" class="level5">
<h5 class="anchored" data-anchor-id="siva-thambisetty-begins-2736">Siva Thambisetty (begins: 27:36)</h5>
<p>Siva Thambisetty from the LSE reflected on the implications and lessons learned from the BBNJ Treaty for DSI in the context of the CBD. She highlighted the obligations related to Party reporting under the legally binding Treaty, emphasizing the requirement to report the origin of genetic material from which the DSI is sourced, using a Batch Identifier. Additionally, she discussed the obligation for databases holding data within the scope of the BBNJ to report on that data at an aggregate-level every two years. She concluded that the direction of travel is towards the use of identifiers and the mapping of aggregate data flows, and that this shift is necessary to foster trust. She further emphasized that databases should play a key role in the architecture of trust.</p>
<section id="slides-2" class="level6">
<h6 class="anchored" data-anchor-id="slides-2"><a href="https://www.dropbox.com/scl/fi/omteyjqkqa15nznes1jzh/Thambisetty-BBNJ-for-LSE-Roundtable.pptx?rlkey=34jifm9umf4g7xb7bu56yzymo&amp;st=8q534f8s&amp;dl=0">Slides</a></h6>
</section>
</section>
</section>
<section id="the-perspective-from-the-plant-treaty" class="level3">
<h3 class="anchored" data-anchor-id="the-perspective-from-the-plant-treaty">The Perspective from the Plant Treaty</h3>
<section id="alvaro-toledo-begins-4100" class="level5">
<h5 class="anchored" data-anchor-id="alvaro-toledo-begins-4100">Alvaro Toledo (begins: 41:00)</h5>
<p>Alvaro Toledo from the Plant Treaty Secretariat discussed the subscription model under the Plant Treaty, their use of SMTAs, and the importance of data collection to understand the industry landscape.</p>
<p>(No links available)</p>
</section>
</section>
</section>
<section id="block-two---recording" class="level2">
<h2 class="anchored" data-anchor-id="block-two---recording">Block Two - <a href="https://echo360.org.uk/media/e37a6f46-fbef-4e21-8eab-453644bf39c4/public" target="_blank">Recording</a></h2>
<section id="gbifs-approach-to-open-access-to-data-within-a-framework-of-trust-and-transparency" class="level3">
<h3 class="anchored" data-anchor-id="gbifs-approach-to-open-access-to-data-within-a-framework-of-trust-and-transparency">GBIF’s Approach to Open Access to Data within a Framework of Trust and Transparency</h3>
<section id="tim-hirsch-begins-0045" class="level5">
<h5 class="anchored" data-anchor-id="tim-hirsch-begins-0045">Tim Hirsch (begins: 00:45)</h5>
<p>Tim Hirsch provided an overview of the Global Biodiversity Information Facility as an organization, illustrating how its data is used globally. He explained GBIF’s use of Creative Commons licenses for their data and highlighted their user agreement, which clarifies that while GBIF data is free of cost to users, it is not free of responsibilities. He also discussed GBIF’s practice of assigning DOIs to datasets, and to each requested download, which enhances transparency in data usage and enables monitoring of the impact of GBIF data in research and policymaking, while ensuring proper recognition for data providers.</p>
<section id="slides-gbif-terms-of-use-citation-guidelines" class="level6">
<h6 class="anchored" data-anchor-id="slides-gbif-terms-of-use-citation-guidelines"><a href="https://www.dropbox.com/scl/fi/g489i1m661iseo8pc2npv/Hirsch-GBIF-240928_LSE_DSI.pptx?rlkey=pklvb114lgnwnx5smhgjh1p86&amp;st=qntwf3en&amp;dl=0" target="_blank">Slides</a> <a href="https://www.gbif.org/terms" target="_blank">GBIF Terms of Use</a> <a href="https://www.gbif.org/citation-guidelines" target="_blank">Citation Guidelines</a></h6>
</section>
</section>
</section>
<section id="the-insdc-40-years-of-trust" class="level3">
<h3 class="anchored" data-anchor-id="the-insdc-40-years-of-trust">The INSDC: 40 Years of Trust</h3>
<section id="masanori-arita-begins-1429" class="level5">
<h5 class="anchored" data-anchor-id="masanori-arita-begins-1429">Masanori Arita (begins: 14:29)</h5>
<p>Masanori Arita from the DDBJ addressed common questions regarding the INSDC collaboration, including their use of metadata and their efforts to integrate the FAIR and CARE (without the A) principles. He also expressed concerns about DDBJ’s capacity to work with commercial cloud services and the feasibility of the INSDC registering users or charging for access to the database.</p>
<section id="slides-3" class="level6">
<h6 class="anchored" data-anchor-id="slides-3"><a href="https://www.dropbox.com/scl/fi/ncegsu6pmzxsejj0vr9bl/Masanori_insdc_LSE.pptx?rlkey=x7s2wfu0pviscvrnjt3taurd2&amp;st=0qh3xl3k&amp;dl=0" target="_blank">Slides</a></h6>
</section>
</section>
</section>
<section id="the-global-biodata-infrastructure" class="level3">
<h3 class="anchored" data-anchor-id="the-global-biodata-infrastructure">The Global Biodata Infrastructure</h3>
<section id="chuck-cook-begins-2601" class="level5">
<h5 class="anchored" data-anchor-id="chuck-cook-begins-2601">Chuck Cook (begins: 26:01)</h5>
<p>Chuck Cook from the Global Biodata Coalition emphasized that sequence data gains value through comparison with other sequences and as it moves through the biodata resource infrastructure. This infrastructure is an interdependent network of databases and repositories holding various types of biodiversity data, extending beyond genetic sequences to include structures, compounds, interactions, and pathways. He also highlighted the insufficiency of funding to support the current infrastructure and stressed the importance of the free flow of information for the advancement of global science.</p>
<section id="slides-4" class="level6">
<h6 class="anchored" data-anchor-id="slides-4"><a href="https://www.dropbox.com/scl/fi/fgcmknk5i4tadi23ev3v8/Cook_Global_Biodata_LSE_roundtable.pdf?rlkey=m7rbehdgm7u8ort50ghidj10p&amp;st=ry7riq5j&amp;dl=0">Slides</a></h6>
<p><br></p>
<p><em>The LSE Roundtable on Global Biodiversity Finance and Digital Sequence Information was organised by the Ocean Biodiversity Collective and One World Analytics and facilitated by the Meridian Institute the Grantham Research Institute.</em></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="footer.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>


</section>
</section>
</section>
</section>

<script async="" defer="" src="https://scripts.simpleanalyticscdn.com/latest.js"></script></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>